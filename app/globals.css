@tailwind base;
@tailwind components;
@tailwind utilities;

/*
 * Holographic Dream Theme
 *
 * Design tokens and utility classes for Carmenta's visual language.
 * No !important hacks - we use headless primitives instead of fighting
 * pre-styled components.
 */

@layer base {
    :root {
        /* Background & Surface */
        --background: 320 20% 97%; /* #F8F4F8 */
        --foreground: 285 25% 31%;

        --card: 0 0% 100%;
        --card-foreground: 285 25% 31%;

        --popover: 0 0% 100%;
        --popover-foreground: 285 25% 31%;

        /* Primary - Holographic accent */
        --primary: 280 40% 75%;
        --primary-foreground: 0 0% 100%;

        /* Secondary */
        --secondary: 280 20% 95%;
        --secondary-foreground: 285 25% 31%;

        /* Muted */
        --muted: 280 20% 92%;
        --muted-foreground: 285 20% 50%;

        /* Accent */
        --accent: 280 30% 88%;
        --accent-foreground: 285 25% 31%;

        /* Destructive */
        --destructive: 0 60% 70%;
        --destructive-foreground: 0 0% 100%;

        /* Borders & Inputs */
        --border: 280 20% 85%;
        --input: 280 20% 90%;
        --ring: 280 40% 75%;

        /* Border radius */
        --radius: 0.75rem;

        /* Glassmorphism */
        --glass-blur: 24px;

        /* Chat viewport fade - Apple-level subtle fades
         * Uses fixed pixels, not percentages, for consistent subtlety
         * Top fade: hint that content exists above
         * Bottom fade: slightly larger to transition into input dock area */
        --chat-fade-top: 40px;
        --chat-fade-bottom: 56px;
    }

    .dark {
        --background: 280 30% 8%;
        --foreground: 280 20% 90%;

        --card: 280 30% 12%;
        --card-foreground: 280 20% 90%;

        --popover: 280 30% 10%;
        --popover-foreground: 280 20% 90%;

        --primary: 280 50% 65%;
        --primary-foreground: 280 30% 8%;

        --secondary: 280 20% 20%;
        --secondary-foreground: 280 20% 90%;

        --muted: 280 20% 18%;
        --muted-foreground: 280 15% 60%;

        --accent: 280 25% 20%;
        --accent-foreground: 280 20% 90%;

        --destructive: 0 50% 50%;
        --destructive-foreground: 0 0% 100%;

        --border: 280 20% 25%;
        --input: 280 20% 20%;
        --ring: 280 50% 65%;
    }
}

@layer base {
    * {
        @apply border-border;
    }

    html {
        /* Smooth scrolling for in-page navigation */
        scroll-behavior: smooth;

        /* Prevent text size adjustment on orientation change */
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;

        /* Better tap behavior on iOS */
        -webkit-tap-highlight-color: transparent;
    }

    body {
        @apply bg-background text-foreground;
        font-feature-settings:
            "rlig" 1,
            "calt" 1;
    }
}

@layer components {
    /* Glassmorphism card */
    .glass-card {
        @apply rounded-2xl p-6;
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        box-shadow:
            0 8px 32px rgba(180, 140, 200, 0.2),
            0 0 0 1px rgba(255, 255, 255, 0.6),
            inset 0 1px 0 rgba(255, 255, 255, 0.8);
    }

    .dark .glass-card {
        background: rgba(40, 30, 50, 0.6);
        box-shadow:
            0 8px 32px rgba(100, 80, 120, 0.3),
            0 0 0 1px rgba(255, 255, 255, 0.1),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    /* User message bubble with holographic gradient */
    .user-message-bubble {
        background: linear-gradient(
            135deg,
            rgba(200, 160, 220, 0.3),
            rgba(160, 200, 220, 0.3)
        );
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
    }

    .dark .user-message-bubble {
        background: linear-gradient(
            135deg,
            rgba(160, 120, 180, 0.4),
            rgba(120, 160, 180, 0.4)
        );
    }

    /* Assistant message bubble with glass effect */
    .assistant-message-bubble {
        background: rgba(255, 255, 255, 0.5);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
    }

    .dark .assistant-message-bubble {
        background: rgba(60, 50, 70, 0.6);
    }

    /* Error message bubble */
    .error-message-bubble {
        background: rgba(220, 38, 38, 0.1);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
    }

    .dark .error-message-bubble {
        background: rgba(180, 30, 30, 0.2);
    }

    /* Glassmorphism input dock */
    .glass-input-dock {
        @apply rounded-[28px] p-2;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        box-shadow:
            0 8px 32px rgba(180, 140, 200, 0.25),
            0 0 0 1px rgba(255, 255, 255, 0.7),
            inset 0 1px 0 rgba(255, 255, 255, 0.9);
    }

    /* Holographic gradient button */
    .btn-holo {
        @apply relative inline-flex items-center justify-center rounded-full px-6 py-3 text-sm font-medium text-white transition-all;
        background: linear-gradient(
            135deg,
            rgba(200, 160, 220, 0.9) 0%,
            rgba(160, 200, 220, 0.9) 50%,
            rgba(220, 180, 200, 0.9) 100%
        );
        box-shadow: 0 4px 16px rgba(180, 140, 200, 0.3);
    }

    .btn-holo:hover {
        @apply scale-105;
        box-shadow: 0 8px 24px rgba(180, 140, 200, 0.4);
    }

    /* Greeting text styles */
    .greeting-title {
        @apply text-4xl font-light tracking-tight md:text-5xl;
        color: rgba(90, 60, 100, 0.85);
        letter-spacing: -1.5px;
        text-shadow: 0 2px 20px rgba(255, 255, 255, 0.5);
    }

    .greeting-subtitle {
        @apply text-base;
        color: rgba(120, 90, 130, 0.8);
    }
}

@layer components {
    /*
     * Holographic Markdown Styles
     *
     * These styles target standard HTML elements rendered by react-markdown.
     * The .holo-markdown container scopes all markdown styling.
     */
    .holo-markdown {
        @apply text-foreground/90;
    }

    .holo-markdown > *:first-child {
        @apply mt-0;
    }

    .holo-markdown > *:last-child {
        @apply mb-0;
    }

    /* Paragraphs */
    .holo-markdown p {
        @apply mb-3;
    }

    .holo-markdown p:last-child {
        @apply mb-0;
    }

    /* Headings */
    .holo-markdown h1 {
        @apply mb-3 mt-4 text-xl font-semibold first:mt-0;
    }

    .holo-markdown h2 {
        @apply mb-2 mt-3 text-lg font-semibold first:mt-0;
    }

    .holo-markdown h3 {
        @apply mb-2 mt-3 text-base font-semibold first:mt-0;
    }

    .holo-markdown h4 {
        @apply mb-2 mt-3 text-sm font-semibold first:mt-0;
    }

    .holo-markdown h5 {
        @apply mb-1 mt-2 text-sm font-medium first:mt-0;
    }

    .holo-markdown h6 {
        @apply mb-1 mt-2 text-xs font-medium uppercase tracking-wide first:mt-0;
    }

    /* Lists */
    .holo-markdown ul {
        @apply my-2 list-disc space-y-1 pl-5;
    }

    .holo-markdown ol {
        @apply my-2 list-decimal space-y-1 pl-5;
    }

    .holo-markdown ul li,
    .holo-markdown ol li {
        @apply leading-relaxed;
    }

    /* Inline code */
    .holo-markdown code:not(pre code) {
        @apply rounded bg-foreground/10 px-1.5 py-0.5 font-mono text-sm;
    }

    /* Code blocks */
    .holo-markdown pre {
        @apply my-3 overflow-x-auto rounded-lg bg-muted p-4 font-mono text-sm text-foreground;
        backdrop-filter: blur(8px);
    }

    .holo-markdown pre code {
        @apply bg-transparent p-0;
    }

    /* Blockquotes */
    .holo-markdown blockquote {
        @apply my-3 border-l-2 border-foreground/20 pl-4 italic text-foreground/70;
    }

    /* Links */
    .holo-markdown a {
        @apply text-primary underline decoration-primary/30 transition-colors hover:decoration-primary;
    }

    /* Horizontal rule */
    .holo-markdown hr {
        @apply my-4 border-foreground/10;
    }

    /* Tables */
    .holo-markdown table {
        @apply my-3 w-full border-collapse text-sm;
    }

    .holo-markdown th {
        @apply border-b border-foreground/20 p-2 text-left font-semibold;
    }

    .holo-markdown td {
        @apply border-b border-foreground/10 p-2;
    }
}

@layer utilities {
    /* Custom scrollbar */
    .scrollbar-holo {
        scrollbar-width: thin;
        scrollbar-color: rgba(180, 140, 200, 0.3) transparent;
    }

    .scrollbar-holo::-webkit-scrollbar {
        width: 8px;
    }

    .scrollbar-holo::-webkit-scrollbar-track {
        background: transparent;
    }

    .scrollbar-holo::-webkit-scrollbar-thumb {
        background: rgba(180, 140, 200, 0.3);
        border-radius: 4px;
    }

    .scrollbar-holo::-webkit-scrollbar-thumb:hover {
        background: rgba(180, 140, 200, 0.5);
    }

    /*
     * Chat viewport fade - Apple-level subtle bidirectional fades
     *
     * Creates whisper-thin fades at both edges:
     * - Top fade (40px): subtle hint under the header
     * - Bottom fade (56px): gentle transition into input dock area
     *
     * The fades are fixed pixels, not percentages, ensuring they remain
     * subtle regardless of viewport height. Content stays readable until
     * the very edge - these are polish, not visibility blockers.
     */
    .chat-viewport-fade {
        mask-image: linear-gradient(
            to bottom,
            transparent,
            black var(--chat-fade-top),
            black calc(100% - var(--chat-fade-bottom)),
            transparent
        );
        -webkit-mask-image: linear-gradient(
            to bottom,
            transparent,
            black var(--chat-fade-top),
            black calc(100% - var(--chat-fade-bottom)),
            transparent
        );
    }

    /* Gentle rotating animation for loading spinner */
    @keyframes spin-slow {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }

    .animate-spin-slow {
        animation: spin-slow 2s linear infinite;
    }

    /*
     * Oracle Animations
     *
     * Visual states for the Carmenta Oracle icon.
     * These communicate Carmenta's current activity level.
     */

    /* ========== BREATHING ANIMATIONS (10 variations: 5 glow + 5 container) ========== */

    /* ===== GLOW VARIATIONS (1-5) ===== */

    /* Glow 1: Whisper - very subtle, slow */
    @keyframes oracle-breathe-glow-1 {
        0%,
        100% {
            transform: scale(1);
            opacity: 0.25;
        }
        50% {
            transform: scale(1.5);
            opacity: 0.55;
        }
    }

    /* Glow 2: Gentle - balanced, soft */
    @keyframes oracle-breathe-glow-2 {
        0%,
        100% {
            transform: scale(1);
            opacity: 0.3;
        }
        50% {
            transform: scale(1.8);
            opacity: 0.7;
        }
    }

    /* Glow 3: Warm - more pronounced */
    @keyframes oracle-breathe-glow-3 {
        0%,
        100% {
            transform: scale(1);
            opacity: 0.35;
        }
        50% {
            transform: scale(2);
            opacity: 0.85;
        }
    }

    /* Glow 4: Vivid - stronger presence */
    @keyframes oracle-breathe-glow-4 {
        0%,
        100% {
            transform: scale(1);
            opacity: 0.4;
        }
        50% {
            transform: scale(2.2);
            opacity: 0.95;
        }
    }

    /* Glow 5: Deep - slow, dramatic */
    @keyframes oracle-breathe-glow-5 {
        0%,
        100% {
            transform: scale(1);
            opacity: 0.2;
        }
        50% {
            transform: scale(2.5);
            opacity: 0.9;
        }
    }

    /* ===== BREATHING: Container "Slow" - centered ±10%, 8s ===== */
    /* Scales from 0.90 (exhale) → 1.10 (inhale) → 0.90 */
    @keyframes oracle-breathe {
        0%,
        100% {
            transform: scale(0.9);
        }
        50% {
            transform: scale(1.1);
        }
    }

    .oracle-breathing {
        animation: oracle-breathe 8s ease-in-out infinite;
    }

    /* ===== WORKING: Rainbow + Glow "Slow" - 3s ===== */
    @keyframes oracle-rainbow-spin {
        from {
            transform: rotate(0deg);
        }
        to {
            transform: rotate(360deg);
        }
    }

    @keyframes oracle-rainbow-glow {
        0%,
        100% {
            transform: scale(1);
            opacity: 0.4;
        }
        50% {
            transform: scale(1.8);
            opacity: 0.9;
        }
    }

    .oracle-working-glow {
        animation: oracle-rainbow-glow 3s ease-in-out infinite;
    }

    .oracle-working-ring {
        animation: oracle-rainbow-spin 3s linear infinite;
    }

    /* ========== NOTIFICATION ANIMATIONS (5 distinct styles) ========== */

    /* N1: Expanding rings - concentric circles pulse outward */
    @keyframes oracle-ring-expand {
        0% {
            transform: scale(1);
            opacity: 1;
        }
        100% {
            transform: scale(2.5);
            opacity: 0;
        }
    }

    /* N2: Pop bounce - icon pops up and bounces */
    @keyframes oracle-pop {
        0% {
            transform: scale(1);
        }
        30% {
            transform: scale(1.3);
        }
        50% {
            transform: scale(0.95);
        }
        70% {
            transform: scale(1.1);
        }
        100% {
            transform: scale(1);
        }
    }

    /* N3: Sparkle burst - particles explode outward */
    @keyframes oracle-sparkle-out {
        0% {
            transform: translateX(0) scale(1);
            opacity: 1;
        }
        100% {
            transform: translateX(var(--sparkle-distance)) scale(0);
            opacity: 0;
        }
    }

    /* N4: Glow flash - bright flash then settle */
    @keyframes oracle-flash {
        0% {
            opacity: 0;
            transform: scale(0.8);
        }
        20% {
            opacity: 1;
            transform: scale(2);
        }
        100% {
            opacity: 0.3;
            transform: scale(1.5);
        }
    }

    /* N5: Shake/wiggle - attention grabbing shake */
    @keyframes oracle-shake {
        0%,
        100% {
            transform: rotate(0deg);
        }
        10% {
            transform: rotate(-8deg);
        }
        20% {
            transform: rotate(8deg);
        }
        30% {
            transform: rotate(-6deg);
        }
        40% {
            transform: rotate(6deg);
        }
        50% {
            transform: rotate(-4deg);
        }
        60% {
            transform: rotate(4deg);
        }
        70% {
            transform: rotate(-2deg);
        }
        80% {
            transform: rotate(2deg);
        }
        90% {
            transform: rotate(0deg);
        }
    }

    /* Shared notify glow */
    @keyframes oracle-notify-glow {
        0% {
            transform: scale(1);
            opacity: 0.3;
        }
        30% {
            transform: scale(1.6);
            opacity: 1;
        }
        100% {
            transform: scale(1.2);
            opacity: 0.5;
        }
    }

    /* Ripple effect for button clicks */
    @keyframes ripple {
        0% {
            transform: translate(-50%, -50%) scale(0);
            opacity: 0.6;
        }
        100% {
            transform: translate(-50%, -50%) scale(10);
            opacity: 0;
        }
    }

    .animate-ripple {
        animation: ripple 0.6s ease-out;
    }

    /* Shake animation for errors */
    @keyframes shake {
        0%,
        100% {
            transform: translateX(0);
        }
        25% {
            transform: translateX(-8px);
        }
        75% {
            transform: translateX(8px);
        }
    }

    /* Carmenta Button States - Centralized interaction patterns */

    /* Glass button base */
    .btn-glass {
        @apply flex items-center justify-center rounded-full;
        @apply bg-white/50 shadow-xl ring-1 ring-white/40 backdrop-blur-xl;
        @apply transition-all duration-300;
    }

    /* Click state - Ripple + depth shift */
    .btn-clickable {
        @apply active:translate-y-0.5 active:shadow-sm;
    }

    /* Hover state - Scale + shadow + ring (same as focus) */
    .btn-hoverable {
        @apply hover:scale-105 hover:shadow-2xl hover:ring-[3px] hover:ring-primary/40;
    }

    /* Focus state - Scale + shadow + ring (same as hover) */
    .btn-focusable {
        @apply focus:scale-105 focus:shadow-2xl focus:outline-none focus:ring-[3px] focus:ring-primary/40;
    }

    /* Disabled state - Grayscale */
    .btn-disabled {
        @apply cursor-not-allowed opacity-50 grayscale;
    }

    /* Complete glass button with all states */
    .btn-glass-interactive {
        @apply btn-glass btn-clickable btn-hoverable btn-focusable;
    }

    /* Icon button variant */
    .btn-icon-glass {
        @apply btn-glass-interactive h-10 w-10 sm:h-12 sm:w-12;
    }

    /* Subtle buttons - for buttons inside glass containers */
    /* These don't need full glass treatment since they're already in a glass container */

    /* Base subtle button - hover and focus are identical */
    .btn-subtle {
        @apply rounded-md transition-all;
        @apply hover:bg-white/50 hover:ring-2 hover:ring-primary/30;
        @apply focus:bg-white/50 focus:outline-none focus:ring-2 focus:ring-primary/30;
        @apply active:scale-95;
    }

    /* Subtle icon button - small icons with scale effect */
    .btn-subtle-icon {
        @apply btn-subtle p-1;
        @apply hover:scale-110 focus:scale-110;
    }

    /* Subtle text button - for text/label buttons */
    .btn-subtle-text {
        @apply btn-subtle px-2 py-1;
        @apply hover:scale-105 focus:scale-105;
    }
}
