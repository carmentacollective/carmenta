#!/bin/sh
echo "ğŸ”„ Checking for updates after merge..."

# Check if package.json or lockfile changed
if git diff-tree -r --name-only --no-commit-id HEAD@{1} HEAD | grep -q "package.json\|bun.lockb"; then
  echo "ğŸ“¦ Dependencies changed - running bun install..."
  bun install --silent
  echo "âœ… Dependencies updated"
fi

# Check if Drizzle schema changed
if git diff-tree -r --name-only --no-commit-id HEAD@{1} HEAD | grep -q "lib/db/schema.ts"; then
  echo "ğŸ—„ï¸  Drizzle schema changed - regenerating migrations..."
  bun run db:generate
  echo "âœ… Drizzle migrations regenerated"
  echo ""
  echo "âš ï¸  IMPORTANT: Review the generated migration in drizzle/migrations/"
  echo "   Then run: bun run db:push (or db:migrate)"
  echo "   The migration will be run automatically on deploy via render-deploy.sh"
fi

echo "âœ… Post-merge checks complete"
