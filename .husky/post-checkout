#!/bin/sh
# Arguments: $1 = previous HEAD, $2 = new HEAD, $3 = branch flag (1 = branch checkout, 0 = file checkout)

# Only run if switching branches (not checking out files)
if [ "$3" = "1" ]; then
  echo "üîÑ Branch switched - checking for differences..."

  CHANGED=0

  # Check if dependencies changed
  if git diff --name-only "$1" "$2" | grep -q "package.json\|bun.lockb"; then
    echo "‚ö†Ô∏è  üì¶ Dependencies differ between branches"
    echo "   Run 'bun install' to update"
    CHANGED=1
  fi

  # Check if Drizzle schema changed
  if git diff --name-only "$1" "$2" | grep -q "lib/db/schema.ts"; then
    echo "‚ö†Ô∏è  üóÑÔ∏è  Drizzle schema differs between branches"
    echo "   Run 'bun run db:generate' to regenerate migrations"
    echo "   Then check drizzle/migrations/ for new files"
    CHANGED=1
  fi

  if [ $CHANGED -eq 0 ]; then
    echo "‚úÖ No critical file differences detected"
  fi
fi
